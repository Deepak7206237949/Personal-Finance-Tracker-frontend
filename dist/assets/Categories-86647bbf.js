import{r as s,A as Y,R as J,b as A,j as e}from"./index-72eb5a6f.js";function Q(){const[u,M]=s.useState([]),[W,N]=s.useState(!0),[k,l]=s.useState(null),[h,x]=s.useState(null),[E,F]=s.useState(""),[z,D]=s.useState(""),[T,R]=s.useState(!1),[f,$]=s.useState("name"),[m,B]=s.useState("asc"),[d,H]=s.useState(""),[I,v]=s.useState(null),[w,y]=s.useState(""),[L,b]=s.useState(""),{user:r}=s.useContext(Y);s.useEffect(()=>{S()},[]),s.useEffect(()=>{if(h){const t=setTimeout(()=>{x(null)},3e3);return()=>clearTimeout(t)}},[h]);const p=J.useMemo(()=>[...u.filter(a=>a.name.toLowerCase().includes(d.toLowerCase()))].sort((a,i)=>{let o,c;switch(f){case"amount":o=a.totalAmount||0,c=i.totalAmount||0;break;case"transactions":o=a.transactionCount||0,c=i.transactionCount||0;break;case"date":o=new Date(a.createdAt),c=new Date(i.createdAt);break;case"name":default:o=a.name.toLowerCase(),c=i.name.toLowerCase();break}return o<c?m==="asc"?-1:1:o>c?m==="asc"?1:-1:0}),[u,f,m,d]),j=t=>{f===t?B(m==="asc"?"desc":"asc"):($(t),B("asc"))},C=t=>f!==t?"↕️":m==="asc"?"↑":"↓",S=async()=>{try{N(!0);const t=await A.get("/categories");M(t.data),l(null)}catch(t){l("Failed to fetch categories"),console.error("Error fetching categories:",t)}finally{N(!1)}},O=async t=>{var a,i;t.preventDefault();const n=E.trim();if(!n){l("Category name cannot be empty");return}if(n.length<2){l("Category name must be at least 2 characters long");return}try{R(!0),l(null),x(null);const o={name:n,amount:parseFloat(z)||0};await A.post("/categories",o),F(""),D(""),x("Category added successfully!"),await S()}catch(o){console.error("Error adding category:",o),((a=o.response)==null?void 0:a.status)===400?l(((i=o.response.data)==null?void 0:i.error)||"Category already exists or invalid data"):l("Failed to add category. Please try again.")}finally{R(!1)}},V=async t=>{var n,a;if(window.confirm("Are you sure you want to delete this category?"))try{l(null),x(null),await A.delete(`/categories/${t}`),x("Category deleted successfully!"),await S()}catch(i){l(((a=(n=i.response)==null?void 0:n.data)==null?void 0:a.error)||"Failed to delete category")}},q=t=>{var n;v(t.id),y(t.name),b(((n=t.amount)==null?void 0:n.toString())||"")},G=async()=>{var t,n;if(!w.trim()){l("Category name cannot be empty");return}try{l(null),x(null);const a={name:w.trim(),amount:parseFloat(L)||0};await A.put(`/categories/${I}`,a),v(null),y(""),b(""),x("Category updated successfully!"),await S()}catch(a){l(((n=(t=a.response)==null?void 0:t.data)==null?void 0:n.error)||"Failed to update category")}},P=()=>{v(null),y(""),b("")};return W?e.jsx("div",{className:"container",children:e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})})}):e.jsx("div",{className:"container",children:e.jsxs("div",{className:"form-container",children:[e.jsx("h1",{children:"Categories Management"}),k&&e.jsx("div",{className:"error-message",children:k}),h&&e.jsx("div",{style:{background:"#d4edda",color:"#155724",padding:"12px",borderRadius:"8px",marginBottom:"20px",border:"1px solid #c3e6cb"},children:h}),e.jsx("div",{style:{marginBottom:"20px"},children:e.jsx("input",{type:"text",placeholder:"Search categories...",value:d,onChange:t=>H(t.target.value),style:{width:"100%",padding:"12px",border:"2px solid #e1e5e9",borderRadius:"8px",fontSize:"16px",outline:"none",transition:"border-color 0.3s ease"},onFocus:t=>t.target.style.borderColor="#007bff",onBlur:t=>t.target.style.borderColor="#e1e5e9"})}),(r==null?void 0:r.role)==="ADMIN"&&e.jsxs("form",{onSubmit:O,style:{marginBottom:"30px"},children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category Name"}),e.jsx("input",{className:"form-input",type:"text",value:E,onChange:t=>F(t.target.value),placeholder:"Enter category name",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Initial Amount / Budget"}),e.jsx("input",{className:"form-input",type:"number",step:"0.01",min:"0",value:z,onChange:t=>D(t.target.value),placeholder:"Enter amount (optional)"})]})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"btn btn-success",disabled:T,children:T?"Adding...":"Add Category"})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"20px",marginBottom:"30px"},children:[e.jsxs("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",padding:"20px",borderRadius:"12px",textAlign:"center"},children:[e.jsx("h3",{style:{margin:"0 0 10px 0",fontSize:"16px"},children:d?"Filtered Categories":"Total Categories"}),e.jsxs("p",{style:{margin:0,fontSize:"24px",fontWeight:"bold"},children:[d?p.length:u.length,d&&e.jsxs("span",{style:{fontSize:"14px",opacity:.8},children:[" of ",u.length]})]})]}),e.jsxs("div",{style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",color:"white",padding:"20px",borderRadius:"12px",textAlign:"center"},children:[e.jsx("h3",{style:{margin:"0 0 10px 0",fontSize:"16px"},children:d?"Filtered Budget":"Total Budget"}),e.jsxs("p",{style:{margin:0,fontSize:"24px",fontWeight:"bold"},children:["$",(d?p:u).reduce((t,n)=>t+(n.amount||0),0).toFixed(2)]})]}),e.jsxs("div",{style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",color:"white",padding:"20px",borderRadius:"12px",textAlign:"center"},children:[e.jsx("h3",{style:{margin:"0 0 10px 0",fontSize:"16px"},children:d?"Filtered Expenses":"Total Expenses"}),e.jsxs("p",{style:{margin:0,fontSize:"24px",fontWeight:"bold"},children:["$",(d?p:u).reduce((t,n)=>t+(n.totalAmount||0),0).toFixed(2)]})]}),e.jsxs("div",{style:{background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",color:"white",padding:"20px",borderRadius:"12px",textAlign:"center"},children:[e.jsx("h3",{style:{margin:"0 0 10px 0",fontSize:"16px"},children:d?"Filtered Transactions":"Total Transactions"}),e.jsx("p",{style:{margin:0,fontSize:"24px",fontWeight:"bold"},children:(d?p:u).reduce((t,n)=>t+(n.transactionCount||0),0)})]})]}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{style:{cursor:"pointer",userSelect:"none"},onClick:()=>j("name"),title:"Click to sort by name",children:["Category Name ",C("name")]}),e.jsxs("th",{style:{cursor:"pointer",userSelect:"none"},onClick:()=>j("amount"),title:"Click to sort by initial amount",children:["Initial Amount ",C("amount")]}),e.jsx("th",{children:"Total Spent"}),e.jsxs("th",{style:{cursor:"pointer",userSelect:"none"},onClick:()=>j("transactions"),title:"Click to sort by transaction count",children:["Transactions ",C("transactions")]}),e.jsxs("th",{style:{cursor:"pointer",userSelect:"none"},onClick:()=>j("date"),title:"Click to sort by creation date",children:["Created Date ",C("date")]}),(r==null?void 0:r.role)==="ADMIN"&&e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:(r==null?void 0:r.role)==="ADMIN"?6:5,style:{textAlign:"center",padding:"40px"},children:"No categories found"})}):p.map(t=>{var o,c;const n=Math.max(...p.map(g=>g.totalAmount||0)),a=t.totalAmount>n*.7&&t.totalAmount>0,i=I===t.id;return e.jsxs("tr",{style:{backgroundColor:a?"#fff5f5":"transparent",borderLeft:a?"4px solid #dc3545":"none"},children:[e.jsx("td",{children:i?e.jsx("input",{type:"text",value:w,onChange:g=>y(g.target.value),style:{width:"100%",padding:"4px",border:"1px solid #ccc",borderRadius:"4px"}}):e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:t.name}),a&&e.jsx("span",{style:{marginLeft:"8px",fontSize:"12px",background:"#dc3545",color:"white",padding:"2px 6px",borderRadius:"10px"},children:"HIGH"})]})}),e.jsx("td",{children:i?e.jsx("input",{type:"number",step:"0.01",min:"0",value:L,onChange:g=>b(g.target.value),style:{width:"100%",padding:"4px",border:"1px solid #ccc",borderRadius:"4px"}}):e.jsxs("span",{style:{color:t.amount>0?"#28a745":"#6c757d",fontWeight:t.amount>0?"bold":"normal"},children:["$",((o=t.amount)==null?void 0:o.toFixed(2))||"0.00"]})}),e.jsxs("td",{children:[e.jsxs("span",{style:{color:t.totalAmount>0?"#dc3545":"#6c757d",fontWeight:t.totalAmount>0?"bold":"normal"},children:["$",((c=t.totalAmount)==null?void 0:c.toFixed(2))||"0.00"]}),t.amount>0&&t.totalAmount>0&&e.jsxs("div",{style:{fontSize:"12px",color:"#6c757d",marginTop:"2px"},children:[(t.totalAmount/t.amount*100).toFixed(1),"% of budget"]})]}),e.jsx("td",{children:e.jsxs("span",{style:{color:"#6c757d"},children:[t.transactionCount||0," transactions"]})}),e.jsx("td",{children:new Date(t.createdAt).toLocaleDateString()}),(r==null?void 0:r.role)==="ADMIN"&&e.jsx("td",{children:i?e.jsxs("div",{style:{display:"flex",gap:"5px"},children:[e.jsx("button",{className:"btn btn-success",onClick:G,style:{fontSize:"12px",padding:"5px 10px"},children:"Save"}),e.jsx("button",{className:"btn btn-secondary",onClick:P,style:{fontSize:"12px",padding:"5px 10px"},children:"Cancel"})]}):e.jsxs("div",{style:{display:"flex",gap:"5px"},children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>q(t),style:{fontSize:"12px",padding:"5px 10px"},children:"Edit"}),e.jsx("button",{className:"btn btn-danger",onClick:()=>V(t.id),style:{fontSize:"12px",padding:"5px 10px"},disabled:t.transactionCount>0,title:t.transactionCount>0?"Cannot delete category with transactions":"Delete category",children:"Delete"})]})})]},t.id)})})]})}),(r==null?void 0:r.role)!=="ADMIN"&&e.jsx("div",{style:{marginTop:"20px",padding:"15px",background:"#f0f8ff",borderRadius:"10px",color:"#666",textAlign:"center"},children:e.jsx("p",{children:"Categories are managed by administrators. You can view and use these categories when creating transactions."})})]})})}export{Q as default};
//# sourceMappingURL=Categories-86647bbf.js.map
